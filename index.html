<!-- https://github.com/plotly/postMessage-API/blob/master/hello_world.html#L52-L117 -->
<!DOCTYPE HTML>
<html>

<title>Plotly postMessage API</title>
<head>
    <script src="//code.jquery.com/jquery-1.10.2.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/base-min.css">
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.5.0/pure-min.css">
    <meta name="description" content="Interactively view x, y slices through my_graphs and contour plots online with Plotly.">
</head>

<body style="font-family: 'Open Sans', serif; background: #edf1f8">

	<div class="pure-g">
		<div class="pure-u-7-24">
			<div style="margin: 0 2em 0; text-align: left; margin-top: 100px;">
				<h1 style="text-transform: uppercase; color: #447bdc;">
					Bind Custom Client-Side to Plotly Graphs
				</h1>

				<p style="font-weight: 300; color: #1d3b84; opacity: 0.5">
					Open your console and try a few things:<br>
					1 - Click, hover, or zoom on points in the my_graph. You'll see the messages printed and you can add custom callbacks to these events.<br><br>
					2 - Make new plots on the client with the postMessage API:
				</p>
			</div>
		</div>
		
		<div>
			<!-- <iframe id = "my_graph"
					src = "https://plot.ly/~msschwartz21/90.embed"
					width = "900" height = "800" frameboarder = "0"
					seamless> 
			</iframe> -->

		</div>

		<div>
			<iframe id = "theta" width="900" height="800" frameborder="0" scrolling="no" src="//plot.ly/~msschwartz21/96.embed"></iframe>
		</div>

		<div>
			<iframe id = "theta2" width="900" height="800" frameborder="0" scrolling="no" src="//plot.ly/~msschwartz21/96.embed"></iframe>
		</div>

	</div>

<script type="text/javascript" charset="utf-8">

function init_graph_obj(id){
	var obj = {
		graphContentWindow: $('#'+id)[0].contentWindow,
		id:id
	};
	obj.pinger = setInterval(function(){
		obj.graphContentWindow.postMessage({task: 'ping'}, '*'); //'https://plot.ly'
	}, 500);
	return obj;
}

var graphs = {};

$('iframe').each(function(i, obj){
	graphs[obj.id] = init_graph_obj(obj.id);
});

console.log(graphs)

window.addEventListener('message', function(e){
	var message = e.data;
	var graph;

	//Figure out which graph the message came from
	for(var i in graphs) {
		if(graphs[i].graphContentWindow === e.source) {
			graph = graphs[i];
		}
	}
	if(typeof graph === "undefined") {
		return;
	}

	var pinger = graph.pinger;
	var graphContentWindow = graph.graphContentWindow;
	var id = graph.id;

	if('pong' in message && message.pong) {
		clearInterval(pinger);
		graphContentWindow.postMessage({
			'task': 'listen',
			'events': ['click', 'hover', 'zoom']
		}, 'https://plot.ly');
	} else if (message.type==='hover' ||
				message.type==='zoom' ||
				message.type==='click') {
		console.log(id, '-->', message);
	}

	//Show hover tag for second graph if first activated
	if(graph.id==='theta' && message.type==='hover') {
		graphs['theta2'].graphContentWindow.postMessage({
			'task': 'hover',
			'selection': {xval: message.points[0].x, yval: message.points[0].y}
		}, 'https://plot.ly');
	}

	//Show hover tag for first graph if second activated
	if(graph.id==='theta2' && message.type==='hover') {
		graphs['theta'].graphContentWindow.postMessage({
			'task': 'hover',
			'selection': {xval: message.points[0].x, yval: message.points[0].y}
		}, 'https://plot.ly');
	}

	//Coordinate zoom
	if(graph.id==='theta' && message.type==='zoom') {
		graphs['theta2'].graphContentWindow.postMessage({
			'task': 'relayout',
			'update': {'xaxis': {'range': [message.ranges.x[0], message.ranges.x[1]]},
						'yaxis': {'range': [message.ranges.y[0], message.ranges.y[1]]}}
		}, 'https://plot.ly');
	}

	//Coordinate zoom
	if(graph.id==='theta2' && message.type==='zoom') {
		graphs['theta'].graphContentWindow.postMessage({
			'task': 'relayout',
			'update': {'xaxis': {'range': [message.ranges.x[0], message.ranges.x[1]]},
						'yaxis': {'range': [message.ranges.y[0], message.ranges.y[1]]}}
		}, 'https://plot.ly');
	}
});


</script>

</body>

</html>
<!-- <iframe width="900" height="800" frameborder="0" scrolling="no" src="//plot.ly/~msschwartz21/90.embed"></iframe> -->